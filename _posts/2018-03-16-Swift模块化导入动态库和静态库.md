---
layout:     post
title:      "Swift模块化导入动态库和静态库"
subtitle:   "Swift模块化导入动态库和静态库"
date:       2018-03-16 12:00:00
author:     "你看那朵乌云儿"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - Swift
---

##问题概述

需要在 Swift 工程添加自己的 C 语言静态库(比如 BRCore, 比特币钱包核心代码, 一堆 C 语言文件)和系统的动态库(sqlite3.tbd, libbz2.tbd).

##添加系统库

以添加 Libbz2 为例:  

1. 在工程目录下新建 Modules 文件夹(专门用来存放各个模块文件), 在 Modules 下新建libbz2, 在 libbz2 文件下创建 iphonesim.modulemap, iphone.modulemap, Info.plist 文件
	
		//iphonesim.modulemap文件
		module libbz2 [system] {
	    header "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/usr/include/bzlib.h"
	    link "bz2"
	    export *
		}
	
2. 在 Target 中 add Cocoa Touch Framework, 创建一个新的 target, 命名为libbz2  

3. 选中 libbz2 这个 target 的 General, 在 Lindked Frameworks and Libraries 中添加 libbz2.tbd  

4. 配置 libbz2 这个 target 的 Module Map File 为第一步创建的文件  

5. 在 General -> Embedded Binaries 中添加 libbz2.framework  

6. 在工程中 `import libbz2`


##添加静态 C 语言库

以添加 BRCore 为例:

1. 在 Modules 文件夹下导入相关的 C 语言文件, 不要添加到 target  

2. 在 C 语言文件根目录下新建 module.modulemap
	
		module BRCore [system] [extern_c] {
		header "BRPeerManager.h"
		export *
		}

3. 在 Target 中 add Cocoa Touch Static Library, 创建一个新的 target, 命名为 BRCore  

4. 在 BRCore 的 Build Phases -> Compile Sources 中添加 .c 文件 (来源于 Modules 中导入的 C 语言文件)  

5. 在 BRCore 的 Build Settings -> Header Search Path 中添加 C 语言头文件路径, 指向 Modules 下该模块的路径  

6. 在工程 target 的 Build Settings -> Swift Compiler - Search Paths 中设置 Import Paths 为第一步创建的 Modules 文件夹  

7. General -> Lindked Frameworks and Libraries 中添加 libBRCore.a  

8. 在工程中 `import BRCore`


##总结

都需要在 Target 下新建 Frameword 或者 Library, 正确编写映射文件, 正确配置相关路径





